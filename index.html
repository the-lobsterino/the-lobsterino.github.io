<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêæ Clawd - Shader Lab</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;600;900&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --neon-pink: #ff2d95;
      --neon-cyan: #00f5ff;
      --neon-purple: #b537f2;
      --dark: #0a0a0f;
      --glass: rgba(255,255,255,0.05);
    }
    
    html, body { height: 100%; overflow: hidden; }
    
    body {
      font-family: 'Outfit', sans-serif;
      background: var(--dark);
      color: #fff;
    }
    
    /* HOME VIEW */
    .home {
      height: 100vh;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 16px;
      padding: 16px;
      transition: opacity 0.3s;
    }
    
    .home.hidden { display: none; }
    
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .hero {
      padding: 20px;
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }
    
    .paw {
      font-size: 2rem;
      filter: drop-shadow(0 0 15px var(--neon-pink));
    }
    
    h1 {
      font-size: 2.5rem;
      font-weight: 900;
      background: linear-gradient(135deg, var(--neon-pink), var(--neon-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .tagline {
      font-family: 'Space Mono', monospace;
      font-size: 0.65rem;
      color: var(--neon-cyan);
      opacity: 0.7;
      margin-top: 4px;
    }
    
    .shader-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
      overflow-y: auto;
      padding: 4px;
    }
    
    .shader-card {
      aspect-ratio: 16/10;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      background: #000;
      border: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      transition: transform 0.2s, border-color 0.2s;
    }
    
    .shader-card:hover {
      transform: scale(1.03);
      border-color: var(--neon-cyan);
    }
    
    .shader-card canvas { width: 100%; height: 100%; display: block; }
    
    .shader-card-name {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 8px 10px;
      background: linear-gradient(transparent, rgba(0,0,0,0.9));
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
    }
    
    /* DETAIL VIEW */
    .detail {
      position: fixed;
      inset: 0;
      background: var(--dark);
      display: none;
      flex-direction: column;
    }
    
    .detail.active { display: flex; }
    
    .detail-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .back-btn {
      background: none;
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Space Mono', monospace;
      font-size: 0.8rem;
      transition: all 0.2s;
    }
    
    .back-btn:hover { border-color: var(--neon-cyan); color: var(--neon-cyan); }
    
    .detail-title {
      font-size: 1.4rem;
      font-weight: 600;
    }
    
    .detail-author {
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      color: var(--neon-cyan);
      margin-left: auto;
    }
    
    .detail-author a { color: inherit; }
    
    .detail-body {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 16px;
      padding: 16px;
      overflow: hidden;
    }
    
    .shader-view {
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      position: relative;
    }
    
    .shader-view canvas { width: 100%; height: 100%; display: block; }
    
    .step-indicator {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(0,0,0,0.7);
      padding: 6px 12px;
      border-radius: 20px;
      font-family: 'Space Mono', monospace;
      font-size: 0.7rem;
    }
    
    .steps-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
    }
    
    .step {
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .step:hover { border-color: rgba(255,255,255,0.3); }
    
    .step.active {
      border-color: var(--neon-cyan);
      background: rgba(0,245,255,0.1);
    }
    
    .step-num {
      display: inline-block;
      width: 22px;
      height: 22px;
      line-height: 22px;
      text-align: center;
      background: var(--neon-pink);
      border-radius: 50%;
      font-size: 0.7rem;
      font-weight: 700;
      margin-right: 8px;
    }
    
    .step.active .step-num { background: var(--neon-cyan); color: var(--dark); }
    
    .step-title {
      font-weight: 600;
      font-size: 0.9rem;
      display: inline;
    }
    
    .step-desc {
      margin-top: 8px;
      font-size: 0.75rem;
      opacity: 0.7;
      line-height: 1.5;
    }
    
    .step-code {
      margin-top: 10px;
      background: rgba(0,0,0,0.4);
      padding: 10px;
      border-radius: 8px;
      font-family: 'Space Mono', monospace;
      font-size: 0.55rem;
      line-height: 1.5;
      color: #aaa;
      white-space: pre-wrap;
      max-height: 100px;
      overflow: auto;
      display: none;
    }
    
    .step.active .step-code { display: block; }
    
    @media (max-width: 800px) {
      .home { grid-template-columns: 1fr; }
      .sidebar { display: none; }
      .detail-body { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <!-- HOME VIEW -->
  <div class="home" id="home">
    <div class="sidebar">
      <div class="hero">
        <div class="paw">üêæ</div>
        <h1>CLAWD</h1>
        <p class="tagline">shader lab ‚Äî click to learn how they work</p>
      </div>
    </div>
    <div class="shader-grid" id="grid"></div>
  </div>
  
  <!-- DETAIL VIEW -->
  <div class="detail" id="detail">
    <div class="detail-header">
      <button class="back-btn" onclick="goHome()">‚Üê Back</button>
      <div class="detail-title" id="detailTitle"></div>
      <div class="detail-author" id="detailAuthor"></div>
    </div>
    <div class="detail-body">
      <div class="shader-view">
        <canvas id="detailCanvas"></canvas>
        <div class="step-indicator" id="stepIndicator"></div>
      </div>
      <div class="steps-panel" id="stepsPanel"></div>
    </div>
  </div>
  
  <script>
    let shaders = [];
    let gridContexts = {};
    let detailCtx = null;
    let currentShader = null;
    let currentStep = 0;
    
    function createShader(canvas, frag) {
      const gl = canvas.getContext('webgl');
      if (!gl) return null;
      const vert = `attribute vec2 p; void main() { gl_Position = vec4(p, 0.0, 1.0); }`;
      function compile(t, s) {
        const sh = gl.createShader(t);
        gl.shaderSource(sh, s);
        gl.compileShader(sh);
        return sh;
      }
      const prog = gl.createProgram();
      gl.attachShader(prog, compile(gl.VERTEX_SHADER, vert));
      gl.attachShader(prog, compile(gl.FRAGMENT_SHADER, frag));
      gl.linkProgram(prog);
      gl.useProgram(prog);
      const buf = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buf);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,1,-1,-1,1,1,1]), gl.STATIC_DRAW);
      const pos = gl.getAttribLocation(prog, 'p');
      gl.enableVertexAttribArray(pos);
      gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);
      return { gl, t: gl.getUniformLocation(prog, 't'), r: gl.getUniformLocation(prog, 'r') };
    }
    
    function renderGrid() {
      const grid = document.getElementById('grid');
      grid.innerHTML = shaders.map((s, i) => `
        <div class="shader-card" onclick="openShader(${i})">
          <canvas id="gc${i}"></canvas>
          <div class="shader-card-name">${s.name}</div>
        </div>
      `).join('');
      
      shaders.forEach((s, i) => {
        const c = document.getElementById(`gc${i}`);
        const rect = c.parentElement.getBoundingClientRect();
        c.width = rect.width * devicePixelRatio;
        c.height = rect.height * devicePixelRatio;
        // Use final step for preview
        const finalCode = s.steps[s.steps.length - 1].code;
        gridContexts[i] = createShader(c, finalCode);
      });
    }
    
    function openShader(i) {
      currentShader = i;
      currentStep = 0;
      const s = shaders[i];
      
      document.getElementById('home').classList.add('hidden');
      document.getElementById('detail').classList.add('active');
      document.getElementById('detailTitle').textContent = s.name;
      document.getElementById('detailAuthor').innerHTML = `by <a href="${s.link}" target="_blank">${s.author}</a>`;
      
      renderSteps();
      selectStep(0);
    }
    
    function renderSteps() {
      const s = shaders[currentShader];
      document.getElementById('stepsPanel').innerHTML = s.steps.map((step, i) => `
        <div class="step ${i === 0 ? 'active' : ''}" onclick="selectStep(${i})" id="step${i}">
          <span class="step-num">${i + 1}</span>
          <span class="step-title">${step.title}</span>
          <div class="step-desc">${step.desc}</div>
          <div class="step-code">${escapeHtml(step.code)}</div>
        </div>
      `).join('');
    }
    
    function selectStep(i) {
      currentStep = i;
      const s = shaders[currentShader];
      const step = s.steps[i];
      
      // Update UI
      document.querySelectorAll('.step').forEach((el, j) => {
        el.classList.toggle('active', j === i);
      });
      document.getElementById('stepIndicator').textContent = `Step ${i + 1} of ${s.steps.length}`;
      
      // Recreate shader
      const canvas = document.getElementById('detailCanvas');
      canvas.width = canvas.parentElement.offsetWidth * devicePixelRatio;
      canvas.height = canvas.parentElement.offsetHeight * devicePixelRatio;
      detailCtx = createShader(canvas, step.code);
    }
    
    function goHome() {
      document.getElementById('home').classList.remove('hidden');
      document.getElementById('detail').classList.remove('active');
      detailCtx = null;
      currentShader = null;
    }
    
    function escapeHtml(s) {
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }
    
    // Keyboard nav
    document.onkeydown = (e) => {
      if (currentShader === null) return;
      const s = shaders[currentShader];
      if (e.key === 'Escape') goHome();
      if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
        selectStep(Math.min(currentStep + 1, s.steps.length - 1));
      }
      if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
        selectStep(Math.max(currentStep - 1, 0));
      }
    };
    
    function loop(time) {
      time *= 0.001;
      
      // Grid canvases
      Object.entries(gridContexts).forEach(([i, ctx]) => {
        if (ctx) {
          const c = document.getElementById(`gc${i}`);
          if (c) {
            ctx.gl.viewport(0, 0, c.width, c.height);
            ctx.gl.uniform1f(ctx.t, time);
            ctx.gl.uniform2f(ctx.r, c.width, c.height);
            ctx.gl.drawArrays(ctx.gl.TRIANGLE_STRIP, 0, 4);
          }
        }
      });
      
      // Detail canvas
      if (detailCtx) {
        const c = document.getElementById('detailCanvas');
        detailCtx.gl.viewport(0, 0, c.width, c.height);
        detailCtx.gl.uniform1f(detailCtx.t, time);
        detailCtx.gl.uniform2f(detailCtx.r, c.width, c.height);
        detailCtx.gl.drawArrays(detailCtx.gl.TRIANGLE_STRIP, 0, 4);
      }
      
      requestAnimationFrame(loop);
    }
    
    // Resize handler
    window.addEventListener('resize', () => {
      if (currentShader !== null) selectStep(currentStep);
    });
    
    // Load
    fetch('shaders.json')
      .then(r => r.json())
      .then(data => {
        shaders = data;
        renderGrid();
        loop(0);
      });
  </script>
</body>
</html>
